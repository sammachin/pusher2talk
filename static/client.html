<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Pusher2Talk</title>
	<script type="text/javascript" src="http://static.twilio.com/libs/twiliojs/1.0/twilio.min.js"></script>
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script>
    <script type="text/javascript">

        Twilio.Device.setup('{{token}}');

        Twilio.Device.ready(function (device) {
            $("#log").text("Ready");
        });

        Twilio.Device.error(function (error) {
			console.log(error);
            $("#log").text("Error: " + error.message);
        });

        Twilio.Device.connect(function (conn) {
			console.log(conn.status);
            $("#log").text("Successfully established call");
        });

        Twilio.Device.disconnect(function (conn) {
			console.log(conn.status);
            $("#log").text("Call ended");
        });

        Twilio.Device.incoming(function (conn) {
            $("#log").text("Incoming connection from " + conn.parameters.From);
            // accept the incoming connection and start two-way audio
            conn.accept();
        });

        function call() {
            Twilio.Device.connect();
			
        }

        function hangup() {
            Twilio.Device.disconnectAll();
        }
    </script>
  </head>
  <body>
    <button class="call" onclick="call();">
      Call
    </button>

    <button class="hangup" onclick="hangup();">
      Hangup
    </button>

    <div id="log">Loading ...</div>
	</body>

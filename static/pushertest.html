<!DOCTYPE html>
<head>
<title>Pusher Test</title>
<script src="http://js.pusher.com/1.12/pusher.min.js" type="text/javascript"></script>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
<script type="text/javascript">

Pusher.channel_auth_endpoint = '/pusher2talk/pusherauth';

//Pusher Debug to print to log
//Pusher.log = function(message) {
//  if (window.console && window.console.log) {
//    window.console.log(message);
// }
//};


var pusher = new Pusher('c75e1662bedf930571b3');
var channel = pusher.subscribe("private-{{room}}");

function bind_event(){
	channel.bind('client-talk', function(data) {
			document.getElementById('user').innerHTML = data.user;
			var sound = document.getElementById("sound1");
			document.getElementById('ptt').style.visibility = 'hidden';
			sound.Play();
	   		}
	);
	channel.bind('client-stop', function(data) {
			document.getElementById('user').innerHTML = "";
			var sound = document.getElementById("sound1");
			document.getElementById('ptt').style.visibility = 'visible';
			sound.Play();
			   		}
	);		
	document.getElementById('room').innerHTML = "Joined {{room}}";
	
}

function ptt_on(){		
	channel.trigger('client-talk', { "user" : "{{user}}" });
}

function ptt_off(){
  	channel.trigger('client-stop', { "user" : "{{user}}" });
}

	
</script>
</head>

<body onload="bind_event()">

<div id="room"></div><br>
<div id="talking"></div>
<button id="ptt" onmousedown="ptt_on()" onmouseup="ptt_off()">TALK</button>



<embed src="static/chirp.mp3" autostart="false" width="0" height="0" id="sound1" enablejavascript="true">
</body> 
</html>
<!DOCTYPE html>
<head>
<title>Pusher Test</title>
<script src="http://js.pusher.com/1.11/pusher.min.js" type="text/javascript"></script>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
<script type="text/javascript">
   
function doPusher(){
	var pusher = new Pusher('c75e1662bedf930571b3');
	pusher.channel_auth_endpoint = './pusher_auth';
	var channel = pusher.subscribe("presence-test");
	channel.bind('client-talk', function(data) {
			document.getElementById('status').innerHTML = "Talking:"+ data.user;
			var sound = document.getElementById("sound1");
			sound.Play();
	   		}
	);
	channel.bind('client-stop', function(data) {
			document.getElementById('status').innerHTML = "";
			var sound = document.getElementById("sound1");
			sound.Play();
			   		}
	);		
	document.getElementById('status').innerHTML = "Ready:";
	
}

function ptt_on(){
	var pusher = new Pusher('c75e1662bedf930571b3');
	pusher.channel_auth_endpoint = './pusher_auth';
	var channel = pusher.subscribe('presence-test');
	channel.bind('pusher:subscription_succeeded', function() {
  		var triggered = channel.trigger('client-talk', { "Talking" : "TestUser" });
	});
}
function ptt_off(){
	var pusher = new Pusher('c75e1662bedf930571b3');
	pusher.channel_auth_endpoint = './pusher_auth';
	
	var channel = pusher.subscribe('presence-test');
	channel.bind('pusher:subscription_succeeded', function() {
  		var triggered = channel.trigger('client-stop', { "Talking" : "TestUser" });
	});
}

	
</script>
</head>

<body>

<div id="status"></div>
<embed src="chirp.mp3" autostart="false" width="0" height="0" id="sound1" enablejavascript="true">
<form name="settings">
<input id="save" type=button value="Subscribe" onclick="doPusher()">  
<button onmousedown="ptt_on()" onmouseup="ptt_off()">TALK</button>

</div>

</body> 
</html>